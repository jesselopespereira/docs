---
title: 'POST /api/kriging'
description: 'Generates a heat map using Kriging interpolation.'
---

## Endpoint

```
POST /api/kriging
```

Generates a heat map PNG image through spatial interpolation using Kriging based on provided geographic points.

## Request body

<ParamField body="points" type="array" required>
  Array of points with geographic coordinates and values. **Minimum of 3 points**.
  
  <Expandable title="Point object structure">
    ```typescript
    {
      x: number;      // Longitude
      y: number;      // Latitude
      value: number;  // Value to be interpolated
    }
    ```
  </Expandable>
</ParamField>

<ParamField body="colors" type="string[]">
	A hexadecimal color array is used to create the map gradient. If omitted, it
	uses a standard 64-color palette from green (#2DCC70) to red (#E74B3C).
	```json ["#0000FF", "#00FF00", "#FFFF00", "#FF0000"] ```
</ParamField>

<ParamField body="polygon" type="object">
  GeoJSON polygon that delimits the interpolation area. Must follow the GeoJSON Polygon specification.
  
  <Expandable title="Polygon structure">
    ```json
    {
      "type": "Polygon",
      "coordinates": [[
        [longitude, latitude],
        [longitude, latitude],
        [longitude, latitude],
        [longitude, latitude]  // The first and last dots must be the same.
      ]],
      "bbox": [minLng, minLat, maxLng, maxLat]  // Optional
    }
    ```
  </Expandable>
</ParamField>

## Response

<ResponseField name="imageUrl" type="string">
	Full URL to access the generated PNG image. The image is stored on the server.
	``` http://localhost:3000/public/kriging_a1b2c3d4e5f6.png ```
</ResponseField>

## Examples

<CodeGroup>

```bash cURL
curl -X POST http://localhost:3000/api/kriging \
  -H "Content-Type: application/json" \
  -d '{
    "points": [
      { "x": -46.6333, "y": -23.5505, "value": 25.5 },
      { "x": -46.6400, "y": -23.5600, "value": 28.3 },
      { "x": -46.6250, "y": -23.5450, "value": 22.1 },
      { "x": -46.6380, "y": -23.5480, "value": 26.8 }
    ]
  }'
```

```javascript JavaScript/Node.js
const response = await fetch('http://localhost:3000/api/kriging', {
	method: 'POST',
	headers: {
		'Content-Type': 'application/json'
	},
	body: JSON.stringify({
		points: [
			{ x: -46.6333, y: -23.5505, value: 25.5 },
			{ x: -46.64, y: -23.56, value: 28.3 },
			{ x: -46.625, y: -23.545, value: 22.1 },
			{ x: -46.638, y: -23.548, value: 26.8 }
		],
		colors: ['#0000FF', '#00FFFF', '#00FF00', '#FFFF00', '#FF0000']
	})
});

const data = await response.json();
console.log(data.imageUrl);
```

```python Python
import requests

url = 'http://localhost:3000/api/kriging'
payload = {
    "points": [
        {"x": -46.6333, "y": -23.5505, "value": 25.5},
        {"x": -46.6400, "y": -23.5600, "value": 28.3},
        {"x": -46.6250, "y": -23.5450, "value": 22.1},
        {"x": -46.6380, "y": -23.5480, "value": 26.8}
    ]
}

response = requests.post(url, json=payload)
result = response.json()
print(result['imageUrl'])
```

```php PHP
<?php
$url = 'http://localhost:3000/api/kriging';
$data = [
    'points' => [
        ['x' => -46.6333, 'y' => -23.5505, 'value' => 25.5],
        ['x' => -46.6400, 'y' => -23.5600, 'value' => 28.3],
        ['x' => -46.6250, 'y' => -23.5450, 'value' => 22.1],
        ['x' => -46.6380, 'y' => -23.5480, 'value' => 26.8]
    ]
];

$options = [
    'http' => [
        'header'  => "Content-type: application/json\r\n",
        'method'  => 'POST',
        'content' => json_encode($data)
    ]
];

$context  = stream_context_create($options);
$result = file_get_contents($url, false, $context);
$response = json_decode($result);

echo $response->imageUrl;
?>
```

</CodeGroup>

## Example with Polygon

```json
{
	"points": [
		{ "x": -46.6333, "y": -23.5505, "value": 25.5 },
		{ "x": -46.64, "y": -23.56, "value": 28.3 },
		{ "x": -46.625, "y": -23.545, "value": 22.1 },
		{ "x": -46.638, "y": -23.548, "value": 26.8 },
		{ "x": -46.63, "y": -23.555, "value": 24.2 }
	],
	"polygon": {
		"type": "Polygon",
		"coordinates": [
			[
				[-46.65, -23.56],
				[-46.65, -23.54],
				[-46.62, -23.54],
				[-46.62, -23.56],
				[-46.65, -23.56]
			]
		],
		"bbox": [-46.65, -23.56, -46.62, -23.54]
	},
	"colors": ["#2DCC70", "#33D130", "#E28D39", "#E74B3C"]
}
```

## Status Codes

<ResponseField name="200" type="Success">
	Map successfully generated. Returns object with `imageUrl`.
</ResponseField>

<ResponseField name="400" type="Bad Request">
	Invalid request. Possible causes: - Fewer than 3 points provided - Invalid
	GeoJSON polygon - Incorrect data structure
</ResponseField>

<ResponseField name="500" type="Internal Server Error">
	Internal error in processing. Usually related to failures in interpolation or
	image generation.
</ResponseField>

## Technical Parameters

The API uses the following fixed parameters for the Kriging algorithm:

| Parameter       | Value         | Description                                              |
| --------------- | ------------- | -------------------------------------------------------- |
| Variogram Model | `exponential` | Mathematical model used to calculate spatial correlation |
| SigmaÂ²          | `0`           | Variance of measurement error                            |
| Alpha           | `5`           | Variogram range parameter                                |
| Grid Step       | `0.0001`      | Interpolation grid resolution                            |

## Cache and Performance

- The API generates a unique MD5 hash for each parameter combination
- Identical requests return the cached image instantly
- Images are saved in `/public` with the name `kriging_{hash}.png`
- The hash considers: ordered points, colors, polygon, and variogram parameters.

## Limitations

<Warning>
	- Minimum of **3 points** required for interpolation - The polygon must be a
	valid GeoJSON Polygon - The first and last points of the polygon must be
	identical - The payload limit is **50MB**
</Warning>

## Use Cases

### Temperature Analysis

```json
{
	"points": [
		{ "x": -46.6333, "y": -23.5505, "value": 28.5 },
		{ "x": -46.64, "y": -23.56, "value": 31.2 },
		{ "x": -46.625, "y": -23.545, "value": 26.8 }
	],
	"colors": ["#0000FF", "#00FF00", "#FFFF00", "#FF0000"]
}
```

### Air Quality

```json
{
	"points": [
		{ "x": -46.6333, "y": -23.5505, "value": 45 },
		{ "x": -46.64, "y": -23.56, "value": 78 },
		{ "x": -46.625, "y": -23.545, "value": 32 }
	],
	"colors": ["#00FF00", "#FFFF00", "#FFA500", "#FF0000", "#8B0000"]
}
```
